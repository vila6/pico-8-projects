pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
--game loop
function _init()
 generatelevel()
end

input={x=0,y=0}
player={ax=64, ay=64}
aux={x0=0.0,y0=0.0,x2=0.0,y2=0.0,a1=0.0,a2=0.0}
l=true
gameover=false

function _update60()
		read_input()
		cam_tick(p.x0, p.y0)

		if btnp(ðŸ…¾ï¸) and cangrab(p.x2,p.y2) then
				l = not l
				aux.x0 = p.x0
				aux.y0 = p.y0
				aux.x2 = p.x2
				aux.y2 = p.y2
				
				aux.a1 = p.a1
				aux.a2 = p.a2
				
				p.x0 = aux.x2
				p.y0 = aux.y2
				p.x2 = aux.x2
				p.y2 = aux.y2
				
				aux.a1 = p.a1
				aux.a2 = p.a2
				
				p.a1 = 0.5-(1.0-aux.a2)
				p.a2 = 1.0-(0.5-aux.a1)
	
				p.a2_v = 0
				p.a2_a = 0

		end
		
		p.tick()
end

function _draw()
		cls()
		drawlevel()
		print(mget(p.x0/8,p.y0/8),20,20)
	 line(p.x1,p.y1,p.x0,p.y0,1)
	 line(p.x1,p.y1,p.x2,p.y2,1)
		circfill(p.x0,p.y0,2,l and 8 or 9)
	 circfill(p.x1,p.y1,5,0)
	 circfill(p.x1,p.y1,3,2)
	 circfill(p.x2,p.y2,3,l and 9 or 8)
		
		if gameover then
				print("game over",cam.x+64,cam.y+64)
		end
end

function cangrab(px, py)

		for i=1,#grabables do
				if are_closer_than(grabables[i][3],grabables[i][1],grabables[i][2],px,py) then
					return true
				end
		end
end
-->8
--player
p =
{
		x0 = 0.0,
		y0 = 0.0,
		x1 = 0.0,
		y1 = 0.0,
		x2 = 0.0,
		y2 = 0.0,
		
		a1=0.3,
		a2=-0.6,
		
		a1_v = 0.0,
		a2_v = 0.0,
		a1_a = 0.0,
		a2_a = 0.0,
		
		m1 = 40.0,
		m2 = 40.0,
		
		r1 = 30.0,
		r2 = 30.0,
		
		g=0.02

}

	function p:tick()
		
		num1 = -p.g * (2.0 * p.m1 + p.m2) * sin(p.a1)
		num2 = -p.m2 * p.g *	sin(p.a1-2.0*p.a2)
		num3 = -2.0*sin(p.a1-p.a2)*p.m2
		num4 = p.a2_v*p.a2_v*p.r2+p.a1_v*p.a1_v*p.r1*cos(p.a1-p.a2)
		
		num = num1+num2+num3*num4
		den = p.r1 * (2.0*p.m1+p.m2-p.m2*cos(2*p.a1-2*p.a2))
		
		p.a1_a = num/den
		
		num1 = 2.0*sin(p.a1-p.a2)
		num2 = (p.a1_v*p.a1_v*p.r1*(p.m1+p.m2))
		num3 = p.g*(p.m1+p.m2)*cos(p.a1)
		num4 = p.a2_v*p.a2_v*p.r2*p.m2*cos(p.a1-p.a2)
		
		num = num1*(num2+num3+num4)
		den = p.r2 * (2.0*p.m1+p.m2-p.m2*cos(2.0*p.a1-2.0*p.a2))
		
		p.a2_a = num/den
		
		p.a1_v += p.a1_a
		p.a2_v += p.a2_a
		p.a1 += p.a1_v
		p.a2 += p.a2_v
	
		//p.r1 = 40.0+abs(p.a1_v)*500.0
	 p.x1 = p.x0 + p.r1 * sin(p.a1)
		p.y1 = p.y0 - p.r1 * cos(p.a1)
		
		p.x2 = p.x1 + p.r2 * sin(p.a2)
		p.y2 = p.y1 - p.r2 * cos(p.a2)
	end
-->8
--input
function read_input()
		input.x = 0
		input.x += btn(âž¡ï¸) and 1 or 0
		input.x += btn(â¬…ï¸) and -1 or 0
		
		input.y = 0
		input.y+=btn(â¬†ï¸) and -1 or 0
		input.y+=btn(â¬‡ï¸) and 1 or 0
end
-->8
--helpers
function lerp(a,b,t)
  return a+(b-a)*t
end

function are_closer_than(d, x1,y1, x2,y2)
  local dx = abs(x2-x1)
  local dy = abs(y2-y1)
  return dx < d 
     and dy < d 
     and (dx^2 + dy^2) < d^2
end
-->8
--camera

cam={x=64,y=64}

function cam_tick(tx, ty)
  tx -= 64
  ty -= 64
  
  cam.x = lerp(cam.x, tx, 0.1)
  cam.y = lerp(cam.y, ty, 0.1)
  
  camera(cam.x,cam.y)
end
-->8
--level
numgrabeables=1000
grabables={}
winpoint={0,0}

function generatelevel()
		x=0
		y=0
		r=6
		
		for i=0,numgrabeables do
				add(grabables,{x,y,r})
				x+=rnd(40)-15
				y+=rnd(20)-8
				r=rnd(12)+3
		end
		winpoint = {grabables[#grabables-1][1],grabables[#grabables-1][2]}
end

function drawlevel()
		for i=1,#grabables do
				circfill(grabables[i][1],grabables[i][2],grabables[i][3],4)
		end
		for i=1,#grabables do
				circfill(grabables[i][1],grabables[i][2],grabables[i][3]-1,5)
		end
		circfill(winpoint[1],winpoint[2],grabables[#grabables-1][3],10)
				
end
__gfx__
000000004444444445444444a000a00a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000004000000045444444a0a0a00a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007004011110044444544aaaaa00a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000401111004454454500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000405555004454444500a00a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700400000004444544500aa0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000440000004544544500a0aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000444444444544544400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000000777070707770077077707770000077707770777077700770000070707770777070000000000000000000000000000000000000000000000000000000
07000000700070707070707070700700000007007070700070707070000070700700777070000000000000000000000000000000000000000000000000000000
00700000770007007770707077000700000007007700770077707070000077700700707070000000000000000000000000000000000000000000000000000000
07000000700070707000707070700700000007007070700070007070000070700700707070000000000000000000000000000000000000000000000000000000
70000000777070707000770070700700000007007070777070007700070070700700707077700000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
06606660660000006600066066600000666060606660066066606660000060606600066066606060666066000000066060606660660006606660066000000000
60006060606000006060606006000000600060606060606060600600000060606060600060606060600060600000600060606060606060006000600000000000
60006660606000006060606006000000660006006660606066000600000060606060666066606060660060600000600066606660606060006600666000000000
60006060606000006060606006000000600060606000606060600600000060606060006060606660600060600000600060606060606060606000006000000000
06606060606000006060660006000000666060606000660060600600000006606060660060600600666066600000066060606060606066606660660000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66606000666066600660666000000660666060606660000066606660666006606660000000000000000000000000000000000000000000000000000000000000
60606000600060606000600000006000606060606000000060000600606060000600000000000000000000000000000000000000000000000000000000000000
66606000660066606660660000006660666060606600000066000600660066600600000000000000000000000000000000000000000000000000000000000000
60006000600060600060600000000060606066606000000060000600606000600600000000000000000000000000000000000000000000000000000000000000
60006660666060606600666000006600606006006660000060006660606066000600000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000000777070707770077077707770000077707770777077700770000070707770777070000000001111004444454444444544444445444444454444444544
07000000700070707070707070700700000007007070700070707070000070700700777070000000001111004454454544544545445445454454454544544545
00700000770007007770707077000700000007007700770077707070000077700700707070000000005555004454444544544445445444454454444544544445
07000000700070707000707070700700000007007070700070007070000070700700707070000000000000004444544544445445444454454444544544445445
70000000777070707000770070700700000007007070777070007700070070700700707077700000040000004544544545445445454454454544544545445445
00000000000000000000000000000000000000000000000000000000000000000000000000000000044444444544544445445444454454444544544445445444
66606000666066600660666000000660666066606660606066606660000066600000600066606660666060000000666066606660066066600000000000000000
60606000600060606000600000006000606060600600606060606000000060600000600060606060600060000000600006006060600006000000000000000000
66606000660066606660660000006000666066600600606066006600000066600000600066606600660060000000660006006600666006000000000000000000
60006000600060600060600000006000606060000600606060606000000060600000600060606060600060000000600006006060006006000000000000000000
60006660666060606600666000000660606060000600066060606660000060600000666060606660666066600000600066606060660006000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000000888804454400090044000000440000004400000044000000440000004400000044000000440000004544544545445445440000004400000044000000
07000000888804444444494444444444444444444444444444444444444444444444444444444444444444444544544445445444444444444444444444444444
00700000888804444544999444444444444444444444444444444444444444444444444444444444454444444544444445444444444444444444444444444444
07000000888804444544444440000000400000004000000040000000400000004000000040000000454444444544444445444444400000004000000040000000
70000000888805444444454440111100401111004011110040111100401111004011110040111100444445444444454444444544401111004011110040111100
00000000000005454454454540111100401111004011110040111100401111004011110040111100445445454454454544544545401111004011110040111100
40555500445444454454444540555500405555004055550040555500405555088855550040555500445444454454444544544445405555004055550040555500
40000000444454454444544540000000400000004000000040000000400000888880000040000000444454454444544544445445400000004000000040000000
44000000454454454544544544000000440000004400000044000000440000888880000044000000454454454544544545445445440000004400000044000000
44444444454454444544544444444444444444444444444444444444444444888884444444444444454454444544544445445444444444444444444444444444
44444444454444444544444445444444444444444444444444444444444444488844444445444444454444444544444445444444444444444544444444444444
40000000454444444544444445444444400000004000000040000000400000001000000045444444454444444544444445444444400000004544444440000000
40111100444445444444454444444544401111004011110040111100401111001011110044444544444445444444454444444544401111004444454440111100
40111100445445454454454544544545401111004011110040111100401111001011110044544545445445454454454544544545401111004454454540111100
40555500445444454454444544544445405555004055550040555500405555001055550044544445445444454454444544544445405555004454444540555500
40000000444454454444544544445445400000004000000040000000400000001000000044445445444454454444544544445445400000004444544540000000
44000000454454454544544545445445440000004400000044000000440000004100000045445445454454454544544545445445440000004544544544000000
44444444454454444544544445445444444444444444444444444444444444444144444445445444454454444544544445445444444444444544544444444444
45444444454444444544444445444444454444444544444445444444454444444144444445444444454444444544444445444444444444444444444444444444
45444444454444444544444445444444454444444544444445444444454444444144444445444444454444444544444445444444400000004000000040000000
44444544444445444444454444444544444445444444454444444544444445444144454444444544444445444444454444444544401111004011110040111100
44544545445445454454454544544545445445454454454544544545445445454154454544544545445445454454454544544545401111004011110040111100
44544445445444454454444544544445445444454454444544544445445444454154444544544445445444454454444544544445405555004055550040555500
44445445444454454444544544445445444454454444544544445445444454454144544544445445444454454444544544445445400000004000000040000000
45445445454454454544544545445445454454454544544545445445454454454144544545445445454454454544544545445445440000004400000044000000
45445444454454444544544445445444454454444544544445445444454454444144544445445444454454444544599945445444444444444444444444444444
45444444444444444444444444444444444444444444444444444444444444444144444444444444454444444544999995444444454444444544444445444444
45444444400000004000000040000000400000004000000040000000400000004100000040000000454444444549999999444444454444444544444445444444
44444544401111004011110040111100401111004011110040111100401111004111110040111100444445444449999999444544444445444444454444444544
44544545401111004011110040111100401111004011110040111100401111004111110040111100445445454419999999544545445445454454454544544545
44544445405555004055550040555500405555004055550040555500405555004015550040555500445444411154999994544445445444454454444544544445
44445445400000004000000040000000400000004000000040000000400000004010000040000000444411154444599944445445444454454444544544445445
45445445440000004400000044000000440000004400000044000000440000000000000044000000111154454544544545445445454454454544544545445445
45445444444444444444444444444444444444444444444444444444444444400000004444444111454454444544544445445444454454444544544445445444
45444444444444444444444444444444444444444444444444444444444444000222000444111444454444444544444445444444444444444444444444444444
45444444400000004000000040000000400000004000000040000000400000002222200011000000454444444544444445444444400000004000000040000000
44444544401111004011110040111100401111004011110040111100401110022222220040111100444445444444454444444544401111004011110040111100
44544545401111004011110040111100401111004011110040111100401110022222220040111100445445454454454544544545401111004011110040111100
44544445405555004055550040555500405555004055550040555500405550022222220040555500445444454454444544544445405555004055550040555500
44445445400000004000000040000000400000004000000040000000400000002222200040000000444454454444544544445445400000004000000040000000
45445445440000004400000044000000440000004400000044000000440000000222000044000000454454454544544545445445440000004400000044000000
45445444444444444444444444444444444444444444444444444444444444400000004444444444454454444544544445445444444444444444444444444444
45444444444444444444444444444444444444444444444444444444444444440000044444444444454444444544444445444444444444444444444444444444
45444444400000004000000040000000400000004000000040000000400000004000000040000000454444444544444445444444400000004000000040000000
44444544401111004011110040111100401111004011110040111100401111004011110040111100444445444444454444444544401111004011110040111100
44544545401111004011110040111100401111004011110040111100401111004011110040111100445445454454454544544545401111004011110040111100
44544445405555004055550040555500405555004055550040555500405555004055550040555500445444454454444544544445405555004055550040555500
44445445400000004000000040000000400000004000000040000000400000004000000040000000444454454444544544445445400000004000000040000000
45445445440000004400000044000000440000004400000044000000440000004400000044000000454454454544544545445445440000004400000044000000
45445444444444444444444444444444444444444444444444444444444444444444444444444444454454444544544445445444444444444444444444444444
45444444444444444444444444444444444444444444444444444444444444444444444444444444454444444544444445444444444444444444444444444444
45444444400000004000000040000000400000004000000040000000400000004000000040000000454444444544444445444444400000004000000040000000
44444544401111004011110040111100401111004011110040111100401111004011110040111100444445444444454444444544401111004011110040111100
44544545401111004011110040111100401111004011110040111100401111004011110040111100445445454454454544544545401111004011110040111100
44544445405555004055550040555500405555004055550040555500405555004055550040555500445444454454444544544445405555004055550040555500
44445445400000004000000040000000400000004000000040000000400000004000000040000000444454454444544544445445400000004000000040000000
45445445440000004400000044000000440000004400000044000000440000004400000044000000454454454544544545445445440000004400000044000000
45445444444444444444444444444444444444444444444444444444444444444444444444444444454454444544544445445444444444444444444444444444
45444444444444444444444444444444444444444444444444444444444444444444444444444444454444444544444445444444454444444544444445444444
45444444400000004000000040000000400000004000000040000000400000004000000040000000454444444544444445444444454444444544444445444444
44444544401111004011110040111100401111004011110040111100401111004011110040111100444445444444454444444544444445444444454444444544
44544545401111004011110040111100401111004011110040111100401111004011110040111100445445454454454544544545445445454454454544544545
44544445405555004055550040555500405555004055550040555500405555004055550040555500445444454454444544544445445444454454444544544445
44445445400000004000000040000000400000004000000040000000400000004000000040000000444454454444544544445445444454454444544544445445
45445445440000004400000044000000440000004400000044000000440000004400000044000000454454454544544545445445454454454544544545445445
45445444444444444444444444444444444444444444444444444444444444444444444444444444454454444544544445445444454454444544544445445444
45444444444444444444444444444444444444444444444444444444444444444444444444444444454444444544444445444444454444444544444445444444
45444444400000004000000040000000400000004000000040000000400000004000000040000000454444444544444445444444454444444544444445444444
44444544401111004011110040111100401111004011110040111100401111004011110040111100444445444444454444444544444445444444454444444544
44544545401111004011110040111100401111004011110040111100401111004011110040111100445445454454454544544545445445454454454544544545
44544445405555004055550040555500405555004055550040555500405555004055550040555500445444454454444544544445445444454454444544544445
44445445400000004000000040000000400000004000000040000000400000004000000040000000444454454444544544445445444454454444544544445445

__map__
0202020202020202020202020202020202020202020202010102010102010101010101010202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102010102020202020101020202020202020202020202010101010102010101010101010202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102010101010101010101020201010101010101010202010102010102020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102020101010101010102020201010101010101010202010101010102020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102020201010101010202020201020101020102010202010102010102020202020202020202030200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020201010101010101010202010101010102020202020101020203030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010101010101010102020202020202020202010102010102010102020202020101020202030200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010101010101010102020201010101010102010102010101010102020202020101020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010101010101010102020201010102010102020202010102010102020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010101010101010102020201010102010102020202010101010102020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010101010101010102020202020202020202020202010102010102020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010101010101010102020202020202020202020202010101010102020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010101010101010102020202020202020202020202010102010102020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
